{"version":3,"file":"index.js","sources":["../src/storage.ts","../src/config.ts","../src/enhancer.ts"],"sourcesContent":["const engine = require(\"store/src/store-engine\");\nconst storages = [require(\"store/storages/sessionStorage\")];\nconst plugins = [require(\"store/plugins/defaults\")];\nexport const storage = engine.createStore(storages, plugins);\n","import { storage } from \"./storage\";\n\nconst config = {\n  key: \"model\",\n  storage,\n  blacklist: [\"@@dva\"],\n  whitelist: [],\n  keyPrefix: \"persist\",\n};\n\nexport default config;\n","import _ from \"lodash\";\nimport defaultOptions from \"./config\";\n\nlet lastState = {};\n\nexport default function (opts = {}) {\n  console.log(opts);\n\n  const { key, keyPrefix, blacklist, whitelist, storage } = {\n    ...defaultOptions,\n    ...opts,\n  };\n  const defaultState = storage.get(`${keyPrefix}:${key}`);\n  return (createStore) => (reducer, initialState = defaultState, enhancer) => {\n    const store = createStore(\n      reducer,\n      { ...initialState, ...defaultState },\n      enhancer\n    );\n    function dispatch(action) {\n      const res = store.dispatch(action);\n      let thatState = store.getState();\n      if (_.isArray(whitelist) && !_.isEmpty(whitelist)) {\n        thatState = _.pick(thatState, whitelist);\n      } else if (_.isArray(blacklist) && !_.isEmpty(blacklist)) {\n        thatState = _.omit(thatState, blacklist);\n      }\n      if (!_.isEqual(lastState, thatState)) {\n        lastState = _.merge(lastState, thatState);\n        storage.set(`${keyPrefix}:${key}`, lastState);\n      }\n      return res;\n    }\n    return { ...store, dispatch };\n  };\n}\n"],"names":["engine","require","storages","plugins","storage","createStore","config","key","blacklist","whitelist","keyPrefix","lastState","opts","console","log","defaultOptions","defaultState","get","reducer","initialState","enhancer","store","dispatch","action","res","thatState","getState","_","isArray","isEmpty","pick","omit","isEqual","merge","set"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAMA,MAAM,GAAGC,OAAO,CAAC,wBAAD,CAAtB;;EACA,IAAMC,QAAQ,GAAG,CAACD,OAAO,CAAC,+BAAD,CAAR,CAAjB;EACA,IAAME,OAAO,GAAG,CAACF,OAAO,CAAC,wBAAD,CAAR,CAAhB;EACO,IAAMG,OAAO,GAAGJ,MAAM,CAACK,WAAP,CAAmBH,QAAnB,EAA6BC,OAA7B,CAAhB;;ECDP,IAAMG,MAAM,GAAG;EACbC,EAAAA,GAAG,EAAE,OADQ;EAEbH,EAAAA,OAAO,EAAPA,OAFa;EAGbI,EAAAA,SAAS,EAAE,CAAC,OAAD,CAHE;EAIbC,EAAAA,SAAS,EAAE,EAJE;EAKbC,EAAAA,SAAS,EAAE;EALE,CAAf;;ECCA,IAAIC,SAAS,GAAG,EAAhB;EAEe,qBAAqB;EAAA,MAAXC,IAAW,uEAAJ,EAAI;EAClCC,EAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;;EADkC,+DAI7BG,MAJ6B,GAK7BH,IAL6B;EAAA,MAG1BL,GAH0B,wBAG1BA,GAH0B;EAAA,MAGrBG,SAHqB,wBAGrBA,SAHqB;EAAA,MAGVF,SAHU,wBAGVA,SAHU;EAAA,MAGCC,SAHD,wBAGCA,SAHD;EAAA,MAGYL,OAHZ,wBAGYA,OAHZ;;EAOlC,MAAMY,YAAY,GAAGZ,OAAO,CAACa,GAAR,WAAeP,SAAf,cAA4BH,GAA5B,EAArB;EACA,SAAO,UAACF,WAAD;EAAA,WAAiB,UAACa,OAAD,EAAoD;EAAA,UAA1CC,YAA0C,uEAA3BH,YAA2B;EAAA,UAAbI,QAAa;EAC1E,UAAMC,KAAK,GAAGhB,WAAW,CACvBa,OADuB,oCAElBC,YAFkB,GAEDH,YAFC,GAGvBI,QAHuB,CAAzB;;EAKA,eAASE,QAAT,CAAkBC,MAAlB,EAA0B;EACxB,YAAMC,GAAG,GAAGH,KAAK,CAACC,QAAN,CAAeC,MAAf,CAAZ;EACA,YAAIE,SAAS,GAAGJ,KAAK,CAACK,QAAN,EAAhB;;EACA,YAAIC,qBAAC,CAACC,OAAF,CAAUnB,SAAV,KAAwB,CAACkB,qBAAC,CAACE,OAAF,CAAUpB,SAAV,CAA7B,EAAmD;EACjDgB,UAAAA,SAAS,GAAGE,qBAAC,CAACG,IAAF,CAAOL,SAAP,EAAkBhB,SAAlB,CAAZ;EACD,SAFD,MAEO,IAAIkB,qBAAC,CAACC,OAAF,CAAUpB,SAAV,KAAwB,CAACmB,qBAAC,CAACE,OAAF,CAAUrB,SAAV,CAA7B,EAAmD;EACxDiB,UAAAA,SAAS,GAAGE,qBAAC,CAACI,IAAF,CAAON,SAAP,EAAkBjB,SAAlB,CAAZ;EACD;;EACD,YAAI,CAACmB,qBAAC,CAACK,OAAF,CAAUrB,SAAV,EAAqBc,SAArB,CAAL,EAAsC;EACpCd,UAAAA,SAAS,GAAGgB,qBAAC,CAACM,KAAF,CAAQtB,SAAR,EAAmBc,SAAnB,CAAZ;EACArB,UAAAA,OAAO,CAAC8B,GAAR,WAAexB,SAAf,cAA4BH,GAA5B,GAAmCI,SAAnC;EACD;;EACD,eAAOa,GAAP;EACD;;EACD,+CAAYH,KAAZ;EAAmBC,QAAAA,QAAQ,EAARA;EAAnB;EACD,KArBM;EAAA,GAAP;EAsBD;;;;;;;;;;"}